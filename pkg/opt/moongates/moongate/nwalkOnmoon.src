/*
        Maintened by *Edwards

        2009-09-06
*/
use uo;
use polsys;
include "include/classes";


program walkOnScript( mobile, tile )

        if( mobile.IsA( POLCLASS_NPC ))
                return 0;
        endif
		
       if( GetObjProperty( mobile , CLASSEID_MAGE ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Mage" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_BARD ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Bard" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_MYSTIC_ARCHER ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Bard" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_CRAFTER ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Crafter" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_PALADIN ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Paladin" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_RANGER ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Ranger" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_THIEF ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Thief" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_WARRIOR ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Warrior" );		
			return 0;
		elseif( GetObjProperty( mobile , CLASSEID_POWERPLAYER ) )
			SendSysMessage( mobile, "Moongate only accessible for newbie's, you are spec Powerplayer" );		
			return 0;
		endif	
		
	if( JustTeleported( mobile ))
		return 0;
	endif
 
	if( Distance( mobile, tile ) > 1 )
		SendSysMessage( mobile, "No longer close enough to the moongate." );
		return 0;
	endif

	SetObjProperty( mobile, "#Teleported", ReadMillisecondClock() );
	var result := tile.SendToDestination( mobile );
	if( result.errortext )
		SendSysMessage( mobile, "Error teleporting:"+result.errortext );
		return 0;
	endif

	return 1;
endprogram

function JustTeleported( mobile )

	var tele_time := CInt( GetObjProperty( mobile, "#Teleported" ));
	if( tele_time > ReadMillisecondClock()-800 )
		// Mobile just teleported. Too soon to teleport again.
		return 1;
	else
		// Safe to teleport the mobile
		return 0;
	endif
endfunction
